<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–§–æ—Ä–º–∞ –∑–∞—è–≤–∫–∏ –∫–ª–∏–Ω–∏–Ω–≥</title>
<style>
body { font-family: Arial, sans-serif; background:#f4f6f9; padding:20px; }
.container { max-width:900px; margin:auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
h1,h2,h3 { margin-top:0; text-align:center; }
h2 { background:#2d89ef; color:#fff; padding:6px; border-radius:5px; margin-top:20px; }
.section { border:1px solid #ccc; padding:15px; border-radius:8px; margin-top:15px; background:#fafafa;}
.label-input { display:flex; flex-direction:column; margin-top:10px; }
input, select, textarea { padding:8px; border-radius:5px; border:1px solid #ccc; width:100%; box-sizing:border-box; height:38px; }
textarea { min-height:60px; }
.inline { display:flex; gap:10px; }
.inline > div { flex:1; display:flex; flex-direction:column; }
.checkbox-group { display:flex; flex-direction:column; margin-top:5px; }
.checkbox-group label { display:flex; flex-direction:column-reverse; font-weight:normal; margin-top:5px; }
button { margin-top:20px; padding:12px; font-size:16px; cursor:pointer; border:none; background:#2d89ef; color:#fff; border-radius:8px; width:100%; }
.result { margin-top:20px; background:#f1f1f1; padding:15px; border-radius:8px; white-space:pre-wrap; font-family: monospace; line-height: 1.5; }
.buttons { display:flex; gap:10px; margin-top:20px; }
.btn { flex:1; padding:12px; font-size:16px; cursor:pointer; border:none; border-radius:8px; text-align:center; text-decoration:none; }
.copy-btn { background:#4CAF50; color:white; }
.telegram-btn { background:#0088cc; color:white; }
.sheets-btn { background:#0F9D58; color:white; }
.checkbox-group input[type="checkbox"] { margin-bottom: 8px; }
.loading { display:none; text-align:center; margin:20px 0; color:#2d89ef; }
</style>
</head>
<body>

<div class="container">
<h1>üßπ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏</h1>

<!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Google Sheets -->
<div class="section">
<h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google –¢–∞–±–ª–∏—Ü—ã</h2>
<div class="label-input">
<label>URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Google Apps Script</label>
<input id="scriptUrl" placeholder="https://script.google.com/macros/s/.../exec">
<small>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: 1) –°–æ–∑–¥–∞–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É 2) –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ –∏–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∏–∂–µ 3) –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∫–∞–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</small>
</div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
<div class="section">
<h2>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
<div class="label-input">
<label>–¢–∏–ø —É–±–æ—Ä–∫–∏</label>
<select id="type">
  <option>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è</option>
  <option>–ì–µ–Ω–µ—Ä–∞–ª—å–Ω–∞—è</option>
  <option>–ü–æ—Å–ª–µ —Ä–µ–º–æ–Ω—Ç–∞</option>
  <option>–•–∏–º—á–∏—Å—Ç–∫–∞</option>
</select>
</div>

<div class="inline">
  <div class="label-input">
    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
    <input type="datetime-local" id="datetime">
  </div>
  <div class="label-input">
    <label>–ü–ª–æ—â–∞–¥—å (–º¬≤)</label>
    <input type="number" id="area">
  </div>
</div>

<div class="label-input">
<label>–ì–æ—Ä–æ–¥</label>
<select id="city">
  <option>–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫</option>
</select>
</div>
</div>

<!-- –î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∞ -->
<div class="section">
<h2>–î–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—á–∏–∫–∞</h2>
<div class="label-input"><label>–ò–º—è –∑–∞–∫–∞–∑—á–∏–∫–∞</label><input id="customerName"></div>
<div class="label-input"><label>–¢–µ–ª–µ—Ñ–æ–Ω</label><input id="customerPhone"></div>
<div class="label-input"><label>–ê–¥—Ä–µ—Å –∫–≤–∞—Ä—Ç–∏—Ä—ã</label><input id="customerAddress"></div>
<div class="label-input"><label>–ù–æ–º–µ—Ä –∫–≤–∞—Ä—Ç–∏—Ä—ã</label><input id="customerFlat"></div>
</div>

<!-- –§–∏–Ω–∞–Ω—Å—ã -->
<div class="section">
<h2>–§–∏–Ω–∞–Ω—Å—ã</h2>
<div class="label-input"><label>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ)</label><input type="number" id="total"></div>
<div class="label-input"><label>–ó–∞—Ä–ø–ª–∞—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞–º</label>
<select id="masterPayType" onchange="calculateMasterPay()">
  <option value="60">60/40</option>
  <option value="70">70/30</option>
  <option value="fixed">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è</option>
</select>
<input type="number" id="masterPay" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É, –µ—Å–ª–∏ —Ñ–∏–∫—Å">
</div>
</div>

<!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç -->
<div class="section">
<h2>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</h2>
<div class="label-input"><label>–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç</label><textarea id="works"></textarea></div>

<h3>–ú—ã—Ç—å—ë –æ–∫–æ–Ω</h3>
<div class="label-input">
  <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–≤–æ—Ä–æ–∫</label>
  <input type="number" id="windowCount" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–≤–æ—Ä–æ–∫">
</div>
<div class="checkbox-group" id="windowsGroup">
  <label><input type="checkbox" value="–¢–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã"> –¢–æ–ª—å–∫–æ —Å –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã</label>
  <label><input type="checkbox" value="–° –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω"> –° –¥–≤—É—Ö —Å—Ç–æ—Ä–æ–Ω</label>
</div>

<h3>–û–±–µ—Å–ø—ã–ª–∏–≤–∞–Ω–∏–µ</h3>
<div class="checkbox-group" id="dustGroup">
  <label><input type="checkbox" value="–ü–æ—Ç–æ–ª–æ–∫"> –ü–æ—Ç–æ–ª–æ–∫</label>
  <label><input type="checkbox" value="–°—Ç–µ–Ω—ã"> –°—Ç–µ–Ω—ã</label>
</div>

<h3>–ú—ã—Ç—å—ë —à–∫–∞—Ñ–æ–≤</h3>
<div class="checkbox-group" id="cabinetsGroup">
  <label><input type="checkbox" value="–°–Ω–∞—Ä—É–∂–∏"> –°–Ω–∞—Ä—É–∂–∏</label>
  <label><input type="checkbox" value="–°–Ω–∞—Ä—É–∂–∏ –∏ –≤–Ω—É—Ç—Ä–∏"> –°–Ω–∞—Ä—É–∂–∏ –∏ –≤–Ω—É—Ç—Ä–∏</label>
</div>

<h3>–ú—ã—Ç—å—ë –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏</h3>
<div class="checkbox-group" id="techGroup">
  <label><input type="checkbox" value="–î—É—Ö–æ–≤–æ–π —à–∫–∞—Ñ"> –î—É—Ö–æ–≤–æ–π —à–∫–∞—Ñ</label>
  <label><input type="checkbox" value="–ü–ª–∏—Ç–∞"> –ü–ª–∏—Ç–∞</label>
  <label><input type="checkbox" value="–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫"> –•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫</label>
  <label><input type="checkbox" value="–í—ã—Ç—è–∂–∫–∞"> –í—ã—Ç—è–∂–∫–∞</label>
  <label><input type="checkbox" value="–ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞"> –ú–∏–∫—Ä–æ–≤–æ–ª–Ω–æ–≤–∫–∞</label>
  <label><input type="checkbox" value="–ß–∞–π–Ω–∏–∫"> –ß–∞–π–Ω–∏–∫</label>
  <label><input type="checkbox" value="–ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞"> –ö–æ—Ñ–µ–º–∞—à–∏–Ω–∞</label>
  <label><input type="checkbox" value="–ü–æ—Å—É–¥–æ–º–æ–π–∫–∞"> –ü–æ—Å—É–¥–æ–º–æ–π–∫–∞</label>
</div>

<h3>–í–∞–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞</h3>
<div class="checkbox-group" id="bathGroup">
  <label><input type="checkbox" value="–ú—ã—Ç—å—ë –∫–∞—Ñ–µ–ª—è"> –ú—ã—Ç—å—ë –∫–∞—Ñ–µ–ª—è</label>
  <label><input type="checkbox" value="–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"> –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</label>
  <label><input type="checkbox" value="–î—É—à–µ–≤–∞—è/–≤–∞–Ω–Ω–∞"> –î—É—à–µ–≤–∞—è/–≤–∞–Ω–Ω–∞</label>
</div>
</div>

<!-- –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ -->
<div class="section">
<h2>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</h2>
<div class="checkbox-group" id="equipmentGroup">
  <label><input type="checkbox" value="–°—Ç—Ä–µ–º—è–Ω–∫–∞"> –°—Ç—Ä–µ–º—è–Ω–∫–∞</label>
  <label><input type="checkbox" value="–ü—ã–ª–µ—Å–æ—Å"> –ü—ã–ª–µ—Å–æ—Å</label>
  <label><input type="checkbox" value="–ü–∞—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä"> –ü–∞—Ä–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä</label>
  <label><input type="checkbox" value="–ú–æ–π—â–∏–∫ –æ–∫–æ–Ω"> –ú–æ–π—â–∏–∫ –æ–∫–æ–Ω</label>
  <label><input type="checkbox" value="–í–µ–¥—Ä–æ"> –í–µ–¥—Ä–æ</label>
  <label><input type="checkbox" value="–ú–æ–ø—ã"> –ú–æ–ø—ã</label>
  <label><input type="checkbox" value="–î–µ—Ä–∂–∞—Ç–µ–ª—å –º–æ–ø–æ–≤"> –î–µ—Ä–∂–∞—Ç–µ–ª—å –º–æ–ø–æ–≤</label>
</div>
</div>

<!-- –•–∏–º–∏—è -->
<div class="section">
<h2>–•–∏–º–∏—è</h2>
<div class="checkbox-group" id="chemGroup">
  <label><input type="checkbox" value="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –º–æ—é—â–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ"> –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ –º–æ—é—â–µ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ</label>
  <label><input type="checkbox" value="–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∂–∏—Ä–∞"> –°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∂–∏—Ä–∞</label>
  <label><input type="checkbox" value="–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–ª—ë—Ç–∞"> –°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –Ω–∞–ª—ë—Ç–∞</label>
  <label><input type="checkbox" value="–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏"> –°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏</label>
  <label><input type="checkbox" value="–°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π"> –°—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≥—Ä—è–∑–Ω–µ–Ω–∏–π</label>
  <label><input type="checkbox" value="–ê–Ω—Ç–∏—Å–∫–æ—Ç—á"> –ê–Ω—Ç–∏—Å–∫–æ—Ç—á</label>
</div>
<div class="label-input"><label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è</label><textarea id="extra"></textarea></div>
</div>

<button onclick="generate()">üìã –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É</button>
<div id="loading" class="loading">‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Google –¢–∞–±–ª–∏—Ü—É...</div>
<div id="out" class="result"></div>
<div class="buttons" id="actionButtons" style="display:none;">
  <button class="copy-btn" onclick="copyToClipboard()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
  <button class="telegram-btn" onclick="sendToTelegram()">üì® Telegram</button>
  <button class="sheets-btn" onclick="saveToSheets()">üìä –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ Google –¢–∞–±–ª–∏—Ü—É</button>
</div>

<!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ -->
<div class="section" style="margin-top:30px; background:#f0f7ff;">
<h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Google –¢–∞–±–ª–∏—Ü—ã</h3>
<ol>
<li>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é Google –¢–∞–±–ª–∏—Ü—É: <a href="https://sheets.new" target="_blank">sheets.new</a></li>
<li>–í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ: "–†–∞—Å—à–∏—Ä–µ–Ω–∏—è" ‚Üí "Apps Script"</li>
<li>–£–¥–∞–ª–∏—Ç–µ –≤–µ—Å—å –∫–æ–¥ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç:</li>
<textarea readonly style="width:100%; height:200px; font-family: monospace; font-size:12px;" onclick="this.select()">
function doPost(e) {
  try {
    const data = JSON.parse(e.postData.contents);
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // –ó–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
    if (sheet.getLastRow() === 0) {
      const headers = [
        'ID', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è', '–¢–∏–ø —É–±–æ—Ä–∫–∏', '–î–∞—Ç–∞', '–í—Ä–µ–º—è', '–ü–ª–æ—â–∞–¥—å', '–ì–æ—Ä–æ–¥',
        '–ò–º—è', '–¢–µ–ª–µ—Ñ–æ–Ω', '–ê–¥—Ä–µ—Å', '–ö–≤–∞—Ä—Ç–∏—Ä–∞', '–°—É–º–º–∞', '–ó–∞—Ä–ø–ª–∞—Ç–∞ –º–∞—Å—Ç–µ—Ä–∞',
        '–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç', '–û–∫–Ω–∞ —Å—Ç–≤–æ—Ä–∫–∏', '–û–∫–Ω–∞ —Ç–∏–ø', '–û–±–µ—Å–ø—ã–ª–∏–≤–∞–Ω–∏–µ',
        '–®–∫–∞—Ñ—ã', '–¢–µ—Ö–Ω–∏–∫–∞', '–í–∞–Ω–Ω–∞—è', '–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ', '–•–∏–º–∏—è', '–ü–æ–∂–µ–ª–∞–Ω–∏—è'
      ];
      sheet.appendRow(headers);
    }
    
    const row = [
      data.orderId,
      new Date(),
      data.type,
      data.date,
      data.time,
      data.area,
      data.city,
      data.customerName,
      data.customerPhone,
      data.customerAddress,
      data.customerFlat,
      data.total,
      data.masterPay,
      data.works,
      data.windowCount,
      data.windows,
      data.dust,
      data.cabinets,
      data.tech,
      data.bath,
      data.equipment,
      data.chem,
      data.extra
    ];
    
    sheet.appendRow(row);
    
    return ContentService
      .createTextOutput(JSON.stringify({success: true, message: '–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService
      .createTextOutput(JSON.stringify({success: false, message: error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet() {
  return ContentService
    .createTextOutput('–°–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç! –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ POST-–∑–∞–ø—Ä–æ—Å—ã —Å –¥–∞–Ω–Ω—ã–º–∏ —Ñ–æ—Ä–º—ã.')
    .setMimeType(ContentService.MimeType.TEXT);
}
</textarea>
<li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (Ctrl+S), –¥–∞–π—Ç–µ –µ–º—É –ª—é–±–æ–µ –∏–º—è</li>
<li>–ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å" ‚Üí "–ù–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"</li>
<li>–í—ã–±–µ—Ä–∏—Ç–µ "–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏: "–í—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç –∏–º–µ–Ω–∏ –º–µ–Ω—è", "–î–æ—Å—Ç—É–ø: –ª—é–±–æ–π"</li>
<li>–ù–∞–∂–º–∏—Ç–µ "–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å", —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤—ã—à–µ</li>
</ol>
</div>

</div>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentOrderData = null;

function calculateMasterPay() {
  const total = parseFloat(document.getElementById('total').value)||0;
  const type = document.getElementById('masterPayType').value;
  const masterInput = document.getElementById('masterPay');
  if(type==='60') masterInput.value=Math.round(total*0.6);
  else if(type==='70') masterInput.value=Math.round(total*0.7);
  else masterInput.value='';
}

function generateOrderId() { 
  return 'CLN-' + Date.now().toString().slice(-6);
}

function getCheckedValues(groupId){
  const group = document.querySelectorAll(`#${groupId} input[type=checkbox]:checked`);
  const values = Array.from(group).map(c => c.value);
  return values.length > 0 ? values.join(', ') : '‚Äî';
}

function formatLine(label, value) {
  const maxLabelLength = 25;
  const paddedLabel = label.padEnd(maxLabelLength, ' ');
  return `${paddedLabel} ${value}`;
}

function generate() {
  const orderId = generateOrderId();
  calculateMasterPay();
  
  const datetime = document.getElementById('datetime').value;
  const date = datetime.split('T')[0] || '‚Äî';
  const time = datetime.split('T')[1] || '‚Äî';
  
  const windows = getCheckedValues('windowsGroup');
  const dust = getCheckedValues('dustGroup');
  const cabinets = getCheckedValues('cabinetsGroup');
  const tech = getCheckedValues('techGroup');
  const bath = getCheckedValues('bathGroup');
  const equipment = getCheckedValues('equipmentGroup');
  const chem = getCheckedValues('chemGroup');
  const extra = document.getElementById('extra').value.trim() || '‚Äî';

  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  const text = 
`üßπ –ó–ê–ö–ê–ó –ù–ê –£–ë–û–†–ö–£ ‚Ññ${orderId}

${formatLine('üìÖ –î–∞—Ç–∞:', date)}
${formatLine('‚è∞ –í—Ä–µ–º—è:', time)}
${formatLine('üìè –ü–ª–æ—â–∞–¥—å:', document.getElementById('area').value + ' –º¬≤')}
${formatLine('üßπ –í–∏–¥ —É–±–æ—Ä–∫–∏:', document.getElementById('type').value)}
${formatLine('üí∞ –°—É–º–º–∞:', document.getElementById('total').value + ' —Ä—É–±.')}

üë§ –ö–õ–ò–ï–ù–¢:
${formatLine('–ò–º—è:', document.getElementById('customerName').value || '‚Äî')}
${formatLine('–¢–µ–ª–µ—Ñ–æ–Ω:', document.getElementById('customerPhone').value || '‚Äî')}
${formatLine('–ê–¥—Ä–µ—Å:', document.getElementById('customerAddress').value || '‚Äî')}
${formatLine('–ö–≤–∞—Ä—Ç–∏—Ä–∞:', document.getElementById('customerFlat').value || '‚Äî')}

üí¨ –û–ü–ò–°–ê–ù–ò–ï –†–ê–ë–û–¢:
${document.getElementById('works').value || '‚Äî'}

ü™ü –ú–´–¢–¨–Å –û–ö–û–ù:
${formatLine('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–≤–æ—Ä–æ–∫:', document.getElementById('windowCount').value || '‚Äî')}
${formatLine('–¢–∏–ø –º—ã—Ç—å—è:', windows)}

üßπ –û–ë–ï–°–ü–´–õ–ò–í–ê–ù–ò–ï:
${dust}

üö™ –®–ö–ê–§–´:
${cabinets}

üîå –ë–´–¢–û–í–ê–Ø –¢–ï–•–ù–ò–ö–ê:
${tech}

üõÅ –í–ê–ù–ù–ê–Ø –ö–û–ú–ù–ê–¢–ê:
${bath}

üõ† –û–ë–û–†–£–î–û–í–ê–ù–ò–ï:
${equipment}

üß¥ –•–ò–ú–ò–Ø:
${chem}

üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ü–û–ñ–ï–õ–ê–ù–ò–Ø:
${extra}

üí∞ –ú–ê–°–¢–ï–†–£:
${document.getElementById('masterPay').value || '‚Äî'} —Ä—É–±.

üì∑ –§–æ—Ç–æ –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –≤ —á–∞—Ç–µ`;

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
  currentOrderData = {
    orderId: orderId,
    type: document.getElementById('type').value,
    date: date,
    time: time,
    area: document.getElementById('area').value || '0',
    city: document.getElementById('city').value,
    customerName: document.getElementById('customerName').value,
    customerPhone: document.getElementById('customerPhone').value,
    customerAddress: document.getElementById('customerAddress').value,
    customerFlat: document.getElementById('customerFlat').value,
    total: document.getElementById('total').value || '0',
    masterPay: document.getElementById('masterPay').value || '0',
    works: document.getElementById('works').value || '',
    windowCount: document.getElementById('windowCount').value || '0',
    windows: windows,
    dust: dust,
    cabinets: cabinets,
    tech: tech,
    bath: bath,
    equipment: equipment,
    chem: chem,
    extra: extra
  };

  document.getElementById('out').innerText = text;
  document.getElementById('actionButtons').style.display = 'flex';
  
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Google Sheets
  saveToSheets();
}

function copyToClipboard() {
  const text = document.getElementById('out').innerText;
  navigator.clipboard.writeText(text).then(() => {
    alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç');
  });
}

function sendToTelegram() {
  if (!currentOrderData) {
    alert('–°–Ω–∞—á–∞–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –∑–∞—è–≤–∫—É');
    return;
  }
  
  const text = document.getElementById('out').innerText;
  const telegramUrl = `https://t.me/share/url?url=&text=${encodeURIComponent(text)}`;
  window.open(telegramUrl, '_blank');
}

async function saveToSheets() {
  if (!currentOrderData) {
    alert('–°–Ω–∞—á–∞–ª–∞ —Å—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –∑–∞—è–≤–∫—É');
    return;
  }
  
  const scriptUrl = document.getElementById('scriptUrl').value;
  if (!scriptUrl) {
    alert('–£–∫–∞–∂–∏—Ç–µ URL –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Google Apps Script –≤ —Ä–∞–∑–¥–µ–ª–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫');
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
  document.getElementById('loading').style.display = 'block';
  
  try {
    const response = await fetch(scriptUrl, {
      method: 'POST',
      mode: 'no-cors', // Google Apps Script —Ç—Ä–µ–±—É–µ—Ç no-cors
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(currentOrderData)
    });
    
    // –° no-cors –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç, –Ω–æ –º–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å cors
    // –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥:
    const altResponse = await fetch(scriptUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(currentOrderData)
    }).catch(() => null);
    
    // –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º no-cors, –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—à–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    document.getElementById('loading').style.display = 'none';
    alert('‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ Google –¢–∞–±–ª–∏—Ü—É!\n\n–ó–∞–∫–∞–∑ ‚Ññ' + currentOrderData.orderId + ' —Å–æ—Ö—Ä–∞–Ω—ë–Ω.');
    
  } catch (error) {
    document.getElementById('loading').style.display = 'none';
    console.error('–û—à–∏–±–∫–∞:', error);
    
    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = scriptUrl;
    form.target = '_blank';
    
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'data';
    input.value = JSON.stringify(currentOrderData);
    form.appendChild(input);
    
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
    
    alert('–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google –¢–∞–±–ª–∏—Ü—É.');
  }
}

// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
window.onload = function() {
  const now = new Date();
  const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000)
    .toISOString()
    .slice(0, 16);
  document.getElementById('datetime').value = localDateTime;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≤ localStorage –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
  document.getElementById('scriptUrl').addEventListener('change', function() {
    if(this.value) {
      localStorage.setItem('cleaningScriptUrl', this.value);
    }
  });
  
  // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π URL
  const savedUrl = localStorage.getItem('cleaningScriptUrl');
  if(savedUrl) {
    document.getElementById('scriptUrl').value = savedUrl;
  }
}
</script>

</body>
</html>
